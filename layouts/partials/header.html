<header class="site-header">
  <div class="container">
    
    {{/* Site Masthead */}}
    <div class="site-masthead" style="text-align: center;">
      <h1 class="site-title">
        <a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a>
      </h1>
      <p class="date-banner" style="text-align: center;">{{ now.Format "Monday, January 2, 2006" }}</p>
    </div>

    {{/* Main Navigation - Uses Micro.blog's page management */}}
    <nav class="site-nav" role="navigation" aria-label="Main navigation">
      <ul>
        <li><a href="{{ .Site.BaseURL }}" {{ if .IsHome }}class="active"{{ end }}>Home</a></li>
        {{/* Dynamic pages from Micro.blog settings - sorted by Weight */}}
        {{ range sort .Site.Menus.main "Weight" }}
          <li>
            {{/* Multiple checks for active state */}}
            {{ $menuURL := .URL }}
            {{ $currentURL := $.Page.RelPermalink }}
            {{ $isActive := false }}
            
            {{/* Direct URL match */}}
            {{ if eq $currentURL $menuURL }}
              {{ $isActive = true }}
            {{ end }}
            
            {{/* Check if current URL starts with menu URL (for nested pages) */}}
            {{ if not $isActive }}
              {{ if and (gt (len $menuURL) 1) (hasPrefix $currentURL $menuURL) }}
                {{ $isActive = true }}
              {{ end }}
            {{ end }}
            
            {{/* Check if we're viewing this menu item's page */}}
            {{ if not $isActive }}
              {{ with .Page }}
                {{ if eq $.Page .Page }}
                  {{ $isActive = true }}
                {{ end }}
              {{ end }}
            {{ end }}
            
            {{/* For category pages - check if page title matches menu name */}}
            {{ if not $isActive }}
              {{ if eq $.Page.Title .Name }}
                {{ $isActive = true }}
              {{ end }}
            {{ end }}
            
            {{ if .Page.Params.redirect }}
              <a href="{{ .Page.Params.redirect }}">{{ .Name }}</a>
            {{ else }}
              <a href="{{ .URL | relLangURL | safeURL }}"{{ if $isActive }} class="active"{{ end }}>{{ .Name }}</a>
            {{ end }}
          </li>
        {{ end }}
      </ul>
    </nav>

  </div>
</header>
