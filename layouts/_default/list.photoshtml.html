{{ define "main" }}
<main class="container container-wide">

  {{/* Page Header */}}
  <header class="page-header">
    <h1 class="page-title">Photos</h1>
    <p class="page-description">A visual journal</p>
  </header>

  {{/* Photos Grid */}}
  <section class="photos-page">
    <div class="photos-grid">
      {{/* First try posts with .Params.photos */}}
      {{- $photoPosts := where .Site.Pages ".Params.photos" "!=" nil -}}
      {{ range $photoPosts }}
        <a href="{{ .Permalink }}" class="photo-item">
          {{ range first 1 .Params.photos }}
            <img src="{{ . }}" alt="" loading="lazy" />
          {{ end }}
        </a>
      {{ end }}
      
      {{/* Also find posts with images in content */}}
      {{ $postsWithImages := where .Site.RegularPages "Type" "post" }}
      {{ range $postsWithImages }}
        {{ if and (not .Params.photos) (findRE `<img[^>]+src="([^"]+)"` .Content) }}
          {{ $img := index (findRE `<img[^>]+src="([^"]+)"` .Content) 0 }}
          {{ $src := index (findRE `src="([^"]+)"` $img) 0 }}
          {{ $srcClean := replace (replace $src "src=\"" "") "\"" "" }}
          <a href="{{ .Permalink }}" class="photo-item">
            <img src="{{ $srcClean }}" alt="" loading="lazy" />
          </a>
        {{ end }}
      {{ end }}
    </div>
  </section>

</main>
{{ end }}